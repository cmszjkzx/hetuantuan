<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title><!--@php  echo $goods['title'];@--></title>
    <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="__RESOURCE__/css/base.css?v=2">
    <link rel="stylesheet" href="__RESOURCE__/css/iconfont.css"/>
    <link rel="stylesheet" href="__RESOURCE__/css/weui.css"/>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="__RESOURCE__/css/hetuantuanrest.css" type="text/css"/>
    <script type="text/javascript" src="__RESOURCE__/js/TouchSlide.1.1.js"></script>
    <script type="text/javascript" src="__RESOURCE__/script/remsetting.js"></script>
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <style type='text/css'>
        .my_nav {position: fixed;bottom: 0}
        .my_nav ul{display:box;display:-ms-box;display:-webkit-box;display:flex;display:-ms-flexbox;display:-webkit-flex}
        .my_nav li{display:block;flex:1;-ms-flex:1;-webkit-flex:1;box-flex:1;-ms-box-flex:1;-webkit-box-flex:1}
        .my_nav a:before{content:'\20';display:block}.layer .action a,.order_head .oh_btn.bg_1{background:#F3F3F3;color:#fff;border:1px solid transparent}
        .my_nav{width:100%;background:#efefef}
        .my_nav ul{overflow:hidden}
        .my_nav a{position:relative;display:block;height:43px;line-height:45px;text-align:center;color:#666;border-bottom:1px solid #ddd;padding-bottom:2px;font-size:16px}
        .my_nav a:before{width:1px;height:20px;position:absolute;left:-1px;top:50%;margin-top:-10px;background:#ddd}
        .my_nav li.cur a{padding-bottom:0;border-bottom:3px solid #e4393c;color:#e4393c}
        /*2016-11-16-yanru-begin*/
        .vid-wrapper{width:100%;position:relative;padding-bottom:56.25%;height:0;}
        .vid-wrapper video{position:absolute;top:0;left:0;width:100%;height:100%;}
        /*end*/
    </style>
</head>
<body>
<div style="position: fixed;top: 0.25rem;z-index: 100;width: 100%">
    <a style="float: right;width: 2.1rem;height: 2.1rem;border-radius: 1.05rem;background-color: white;padding: 0.55rem;margin-right: 0.4rem" href="<!--@php  echo mobile_url('shopindex')@-->"><img style="width:1rem;height: 1rem;" src="__RESOURCE__/images/ic_home_pressed.png"></a>
    <a style="float: left;width: 2.1rem;height: 2.1rem;border-radius: 1.05rem;background-color: white;padding: 0.55rem;margin-left: 0.4rem" href="<!--@php  echo mobile_url('mycart')@-->"><img style="width:1rem;height:1rem" src="__RESOURCE__/images/ic_shopping_cart_pressed.png"></a>
</div>
<div class="container">
    <div class="row">
        <!-- banner轮播Start -->
        <div id="focus" class="focus">
            <div class="hd">
                <ul>
                </ul>
            </div>
            <div class="bd">
                <ul>
                    <!--@php  if(is_array($piclist)) { foreach($piclist as $row) { @-->
                    <li><img
                            src="<!--@php echo WEBSITE_ROOT;@-->/attachment/<!--@php  echo $row['attachment'];@-->"/>
                    </li>
                    <!--@php  } } @-->
                </ul>
            </div>
        </div>
        <script type="text/javascript">
            TouchSlide({
                slideCell: "#focus",
                titCell: ".hd ul", //开启自动分页 autoPage:true ，此时设置 titCell 为导航元素包裹层
                mainCell: ".bd ul",
                delayTime: 600,
                interTime: 4000,
                effect: "leftLoop",
                autoPlay: true,//自动播放
                autoPage: true, //自动分页
                switchLoad: "_src" //切换加载，真实图片路径为"_src"
            });
        </script>
        <!-- banner轮播End -->
        <div class="goodtitle">
            <div style="font-size: 0.75rem;color: #3C3C3C">
                <!--@php  echo $goods['title'];@-->
            </div>
        </div>

        <div class="goodprice col-xs-12">
            <!--@php if($goods_min_price != $goods_max_price) { @-->
            <strong id="marketprice" class="goodprice"><!--@php  echo "￥".$goods_min_price. " - ￥" .$goods_max_price;@--></strong>
            <!--@php } else { @-->
            <strong id="marketprice" class="goodprice"><!--@php  echo "￥".$goods_min_price;@--></strong>
            <!--@php } @-->
        </div>
        <div class="weui-cells col-xs-12" onclick='addtocart($(this).attr("id"),true)' style="margin-top: 0">
            <label class="weui-cell weui-cell_select" style="margin-bottom: 0">
                <div class="weui-cell__bd">
                    <label class="font-28" style="padding-top: 0.4rem">请选择规格和数量</label>
                </div>
            </label>
        </div>
        <div class="goodxl col-xs-12">
            <div class="col-xs-6" style="padding-left: 0px;padding-top: 0.4rem;padding-bottom:0.25rem;font-size: 0.6rem;color: #7F7F7F">
                已出售：<!--@php  echo $goods['sales'];@--> 笔
            </div>
        </div>
    </div>
</div>
<div class="container" style="padding-left: 0px;padding-right: 0px;">
    <!-- 商品详情和评价 Start  -->
    <div class="con"><!-- 高度自适应需添加外层 -->
        <p class="sub-title">商品详情</p>
        <ul  style="padding-bottom:2.5rem;">
            <!--@php if(!empty($goods['videopath'])) {@-->
            <div class="vid-wrapper">
                <video type="video/mp4" controls="controls" codecs="avc1.42E01E, mp4a.40.2" src="<?php echo WEBSITE_ROOT;?>attachment/<?php  echo $goods['videopath'];?>"></video>
            </div>
            <!--@php }@-->
            <br/>
            <li style="width: 100%">
                <!--@php  echo $goods['content'];@-->
            </li>
        </ul>
    </div>
</div>
<div class="modal" id="xzmodal" tabindex="-1" aria-labelledby="myModalLabel" role="dialog" aria-hidden="true" data-backdrop="true">
    <div class="modal-dialog" style="position: fixed;bottom: 0;">
        <div class="media" style="padding-left: 15px;position: relative;margin-bottom: -74px;z-index: 2000;">
            <div class="media-left">
                <img class="img-thumbnail media-object" src="<!--@php echo WEBSITE_ROOT;@-->/attachment/<!--@php  echo $goods['thumb'] @-->" style="width:4.5rem;height:4.5rem;border: solid 1px #D9D9D9;border-radius:0;padding: 2px;background-color: white">
            </div>
            <div class="media-body" style="width: 10rem">
                <div class="media-heading" style="padding-top: 30px">
                    <!--<div class="goodtitle">
                        <div style="font-size: 0.75rem;color: #3C3C3C">
                            &lt;!&ndash;@php  echo $goods['title'];@&ndash;&gt;
                        </div>
                    </div>-->
                    <p class="goodprice text-ellipsis font-30 color-3c" style="width: 7rem;margin: 0">
                        <!--@php  echo $goods['title'];@-->
                    </p>
                    <p class="goodprice" style="margin: 0" id="marketprice1">
                        ￥<!--@php  echo $marketprice;@-->
                    </p>
                </div>
            </div>
            <div class="media-right" style="display: none">
                <button style="padding-top: 35px;padding-right: 10px;line-height: 30px;opacity: 1" type="button" class="close" data-dismiss="modal">
                    <img src="__RESOURCE__/images/ic_close_down.png" style="height: 1rem;width: 1rem" onclick="closecart()">
                </button>
            </div>
        </div>

        <div class="modal-content">
            <div class="modal-header" style="height: 80px;border: none">

            </div>
            <div class="modal-body" >

                <form action="javascript:addToCart(6)" method="post" name="ECS_FORMBUY" id="ECS_FORMBUY">
                    <!--@php  if($goods['hasoption']==1) { @-->
                    <!--@php  if(is_array($specs)) { foreach($specs as $spec) { @-->
                    <input type='hidden' name="optionid[]" class='optionid optionid_<!--@php  echo $spec['id'];@-->'
                    value="" title="<!--@php  echo $spec['title'];@-->">
                    <div id='option_group' class='detail-group' style="margin-top:10px;">

                        <div class="detail-group">

                            <p class="font-28" style='margin-left:10px;padding:0'><!--@php  echo $spec['title'];@-->:</p>
                            <span style="float:left;margin-left:8px;" class='color-7f font-26 options options_<!--@php  echo $spec['id'];@-->'
                            specid='<!--@php  echo $spec['id'];@-->'>

                            <!--@php  if(is_array($spec['items'])) { foreach($spec['items'] as $o) { @-->

                            <!--@php  if(empty($o['thumb'])) { @-->
                            <span class="property option option_<!--@php  echo $spec['id'];@-->"
                                  specid='<!--@php  echo $spec['id'];@-->' oid="<!--@php  echo $o['id'];@-->"
                            sel='false'><!--@php  echo $o['title'];@--></span>
                            <!--@php  } else { @-->
                            <span class="propertyimg optionimg option_img_<!--@php  echo $spec['id'];@--> "
                                  oid="<!--@php  echo $o['id'];@-->" specid='<!--@php  echo $spec['id'];@-->'
                            sel='false'><img
                                src="<!--@php echo WEBSITE_ROOT;@-->/attachment/<!--@php  echo $_W['attachurl'].$o['thumb']@-->"
                                width='50' height='50' title="<!--@php  echo $o['title'];@-->"/></span>
                            <!--@php  } @-->

                            <!--@php  } } @-->
                            </span>
                        </div>
                    </div>
                    <!--@php  } } @-->
                    <!--@php  } @-->

                    <p style="padding: 10px;border-bottom: solid 1px #D9D9D9" class="font-28 color-7f">
                        <!--@php  if($stock!=-1) { @-->
                        库存:<span id="goodstotail"><!--@php  echo $stock;@--></span>
                        <!--@php  }else{ @-->库存:0<!--@php  } @-->件
                        <input type="hidden" id="optiontotal" name="optiontotal" value=""/>
                    </p>

                    <div class="goods_number clearfix">
                        <p class="name">购买数量：</p>


                        <div class="input-group ic-input-group" style="margin-top: 0.6rem">
						    <span class="input-group-btn">
						        <button type="button" value="-" class="btn btn-default ic-minus" onClick="chgNum(-1);"></button>
						    </span>
                            <input type="text" class="form-control ic-input" id="total" name="number" value="0" style="height:inherit;text-align: center;width: 1.5rem"/>
                            <span class="input-group-btn">
						        <button type="button" value="+" class="btn btn-default ic-plus" onClick="chgNum(1);"></button>
						    </span>
                        </div>

                    </div>
                </form>
                <input type="hidden" id="optionid" name="optionid" value=""/>
            </div>
            <div class="modal-footer" style="padding: 0;height: 2.4rem">
                <!--@php include themePage('cartFooter');@-->
            </div>
            <!--<div class="modal-footer" style="border: none;padding:0">-->
                <!--<div class="col-xs-12" style="padding-left: 0px;padding-right: 0px;">-->
                    <!--<a id="add-cart" style="background-color:#FFA906;color: #ffffff;height:2.5rem;line-height: 2.5rem;padding: 0;border: none;border-radius: 0" class="btn btn-default btn-block bradius0 ptb10" href="javascript:void(0)" onclick='addtocart($(this).attr("id"))'>加入购物车</a>-->
                    <!--<a id="buy-now" style="background-color:#FFA906;color: #ffffff;height:2.5rem;line-height: 2.5rem;padding: 0;border: none;border-radius: 0" class="btn btn-default btn-block bradius0 ptb10" href="javascript:void(0)" onclick='buy($(this).attr("id"))'>立即购买</a>-->
                <!--</div>-->
            <!--</div>-->
        </div>
    </div>
</div>
<!--@php include themePage('cartFooter');@-->


<script type="text/javascript">
    //立即购买
    var hasoption = <!--@php echo $goods['hasoption']=='1'?'true':'false'@-->;
    function buy(object){
        debugger;
        if($("#xzmodal").is(':hidden'))
            closecart();
        var ret = option_selected();
        var val = $("#xzmodal").attr("class");
        var array = val.split(" ");
        if(ret.no!=''){
            if(array[1] == "in"){
                //tip("请选择" + ret.no + "!",true);
            }else{
                $('#xzmodal').modal('show');
            }
            return;
        }
        var total = $("#total").val();
        <!--@php  if($stock!=-1) { @-->
        if(total>parseInt($("#goodstotail").html()))
        {
            tip("最多只能购买" + parseInt($("#goodstotail").html()) + "件!",true);
            return;

        }
        <!--@php  } @-->
        var total = $("#total").val();
        location.href = '<!--@php  echo mobile_url('confirm',array('id'=>$goods['id']),true);@-->'+"&optionid=" + $("#optionid").val() + "&total=" + total;
        $("#total").val(0);
    }

    //添加到购物车
    function addtocart(object){
        debugger;
        if($("#xzmodal").is(':hidden'))
            closecart();
        var ret = option_selected();
        var val = $("#xzmodal").attr("class");
        var array = val.split(" ");
        if(ret.no!=''){
            if(array[1] == "in"){
                //tip("请选择" + ret.no + "!",true);
            }else{
                $('#xzmodal').modal('show');
            }
            return;
        };
        var total = $("#total").val();
        <!--@php  if($stock!=-1) { @-->
        if(total>parseInt($("#goodstotail").html()))
        {
            tip("最多只能购买" + parseInt($("#goodstotail").html()) + "件!",true);
            return;

        };
        <!--@php  } @-->
        tip("正在处理数据...");
        var url = '<!--@php  echo mobile_url('mycart',array('op'=>'add','id'=>$goods['id']),true);@-->' +"&optionid=" + $("#optionid").val() + "&total=" + total;
        $.getJSON(url, function(s){
            if(s.result==0){
                tip("只能购买 " + s.maxbuy + " 件!",true);
            }else{
                tip_close();
                tip("已加入购物车!");
                //alert("已加入购物车!");
                $('#globalId').css({'width':'22px', 'height':'16px', 'line-height':'16px'}).html(s.total).animate({'width':'15px', 'height':'16px', 'line-height':'20px'}, 'slow');
                $('#carId').css({'width':'22px', 'height':'16px', 'line-height':'16px'}).html(s.total).animate({'width':'15px', 'height':'16px', 'line-height':'20px'}, 'slow');

                var select_option = new Array();
                $("input[name^='optionid']").each(
                    function(){
                        select_option.push($(this).val())
                    });
                var select_option_class = new Array();
                $("input[name^='optionid']").each(
                    function(){
                        select_option_class.push($(this).attr('class'))
                    });
                var select_sepecid = new Array();
                $("span[class$='current']").each(
                    function(){
                        select_sepecid.push($(this).attr('specid'))
                    });
                var select_number = select_sepecid.length;
                for (var i=0; i<select_number; i++){
                    var specid = select_sepecid[i];
                    var oid = select_option[i];
                    $(".optionid_" + specid).val(oid);
                    $(".options_" + specid + "  span").removeClass("current").attr("sel", "false");
                }
                $('#xzmodal').modal('hide');
                $(".optionid").val("");
                $("#total").val(0);
                <!--@php $stock--; @-->
                var option_total = <!--@php  echo $stock @-->;
                $("#goodstotail").html(option_total);
                var len = options.length;
                ret.no = $(".optionid").attr("title");
            };
        });
    }

    function closecart(){
        //debugger;
        var ret = option_selected();
        var val = $("#xzmodal").attr("class");
        var array = val.split(" ");
        if(ret.no!=''){
            if(array[1] == "in"){
                var select_option = new Array();
                $("input[name^='optionid']").each(
                    function(){
                        select_option.push($(this).val())
                    });
                var select_option_class = new Array();
                $("input[name^='optionid']").each(
                    function(){
                        select_option_class.push($(this).attr('class'))
                    });
                var select_sepecid = new Array();
                $("span[class$='current']").each(
                    function(){
                        select_sepecid.push($(this).attr('specid'))
                    });
                var select_number = select_sepecid.length;
                for (var i=0; i<select_number; i++){
                    var specid = select_sepecid[i];
                    var oid = select_option[i];
                    $(".optionid_" + specid).val(oid);
                    $(".options_" + specid + "  span").removeClass("current").attr("sel", "false");
                }
            }else{
                $('#xzmodal').modal('show');
            }
            return;
        };
        var select_option = new Array();
        $("input[name^='optionid']").each(
            function(){
                select_option.push($(this).val())
            });
        var select_option_class = new Array();
        $("input[name^='optionid']").each(
            function(){
                select_option_class.push($(this).attr('class'))
            });
        var select_sepecid = new Array();
        $("span[class$='current']").each(
            function(){
                select_sepecid.push($(this).attr('specid'))
            });
        var select_number = select_sepecid.length;
        for (var i=0; i<select_number; i++){
            var specid = select_sepecid[i];
            var oid = select_option[i];
            $(".optionid_" + specid).val(oid);
            $(".options_" + specid + "  span").removeClass("current").attr("sel", "false");
        }
        $('#xzmodal').modal('hide');
        $(".optionid").val("");
        $("#total").val(0);
        var option_total = <!--@php  echo $stock@-->;
        $("#goodstotail").html(option_total);
        ret.no = $(".optionid").attr("title");
    }

    function option_selected(){
        var ret= {
            no: "",
            all: []
        };//初始化对象，no,all都是变量名
        if(!hasoption){
            return ret;
        }
        $(".optionid").each(function(){
            ret.all.push($(this).val());
            if($(this).val()==''){
                ret.no = $(this).attr("title");
                return false;
            }
        });
        return ret;
    }
</script>

<!--规格选择JS Start-->
<script type="text/javascript">
    var options =<!--@php  echo json_encode($options)@-->;
    var specs =<!--@php  echo json_encode($specs)@-->;
    var hasoption = <!--@php echo $goods['hasoption']=='1'?'true':'false'@-->;

    $(".option,.optionimg").click(function () {
        var specid = $(this).attr("specid");
        var oid = $(this).attr("oid");
        $(".optionid_" + specid).val(oid);
        $(".options_" + specid + "  span").removeClass("current").attr("sel", "false");
        $(this).addClass("current").attr("sel", "true");
        var optionid = "";
        var stock = 0;
        var marketprice = 0;
        var productprice = 0;
        var ret = option_selected();

        if (ret.no == '') {
            var len = options.length;
            for (var i = 0; i < len; i++) {
                var o = options[i];
                var ids = ret.all.join("_");
                if (o.specs == ids) {
                    optionid = o.id;
                    stock = o.stock;
                    marketprice = o.marketprice;
                    productprice = o.productprice;
                    break;
                }
            }
            $("#optionid").val(optionid);
            <!--@php  if($stock!=-1) { @-->
            $("#goodstotail").html(stock);
            $("#total").val(1);
            $("#optiontotal").val(stock);
            <!--@php  } @-->
            $("#marketprice1").html("￥"+marketprice);
            $("#marketprice2").html(marketprice);
            $("#productprice").html(productprice);
            if (productprice <= 0) {
                $("#productpricecontainer").hide();
            }
            else {
                $("#productpricecontainer").show();
            }
        }
    });
</script>
<!--规格选择JS End-->
<!--商品评价、详情、同类推荐JS Start-->
<script type="text/javascript">
    TouchSlide({
        slideCell: "#tabBox1",

        endFun: function (i) { //高度自适应
            var bd = document.getElementById("tabBox1-bd");
            bd.parentNode.style.height = bd.children[i].children[0].offsetHeight + "px";
            if (i > 0)bd.parentNode.style.transition = "200ms";//添加动画效果
        }

    });</script>
<!--商品评价、详情、同类推荐JS End-->




<!--秒杀倒计时JS satart-->
<script language='javascript'>
    var total_time_<!--@php  echo $goods['id'];@--> = <!--@php  echo $goods['timelast'];@-->;
    var int_time_<!--@php  echo $goods['id'];@--> = setInterval(function () {
        d(<!--@php  echo $goods['id'];@-->);
    }, 1000);
</script>

<script type="text/javascript">


    function d(id) {
        eval("total_time_" + id + "--");
        var total_time = eval("total_time_" + id);

        var days = parseInt(total_time / 86400)

        var remain = parseInt(total_time % 86400);
        var hours = parseInt(remain / 3600)
        var remain = parseInt(remain % 3600);

        var mins = parseInt(remain / 60);
        var secs = parseInt(remain % 60);

        if (total_time <= 0) {
            $("#time_" + id).html("时间到了");
            var int_time = eval("int_time_" + id);
            window.clearInterval(int_time);

        } else {

            var ret = "";
            if (days > 0) {
                days = days + "";
                if (days.length <= 1) {
                    days = "0" + days;
                }
                ret += days + " 天 ";
            }
            if (hours > 0) {
                hours = hours + "";
                if (hours.length <= 1) {
                    hours = "0" + hours;
                }
                ret += hours + ":";
            }
            if (mins > 0) {
                mins = mins + "";
                if (mins.length <= 1) {
                    mins = "0" + mins;
                }
                ret += mins + ":";
            }

            secs = secs + "";
            if (secs.length <= 1) {
                secs = "0" + secs;
            }
            ret += secs;


            $("#time_" + id).html(ret);
        }
    }

</script>
<!--秒杀倒计时JS End-->


<script language='javascript'>
    function tip(msg, autoClose) {
        var div = $("#poptip");
        var content = $("#poptip_content");
        if (div.length <= 0) {
            div = $("<div id='poptip'></div>").appendTo(document.body);
            content = $("<div id='poptip_content'>" + msg + "</div>").appendTo(document.body);
        }
        else {
            content.html(msg);
            content.show();
            div.show();
        }
        if (autoClose) {
            setTimeout(function () {
                content.fadeOut(3000);
                div.fadeOut(3000);

            }, 1000);
        }
    }
    function tip_close() {
        $("#poptip").fadeOut(3000);
        $("#poptip_content").fadeOut(3000);
    }
</script>


<!--收藏按钮JS Start-->
<script>
    $(function () {
        $("#collect-link").on("click", function () {
            $("#collect-tip").show();
        })
        $("#a-know").on("click", function () {
            $("#collect-tip").hide();
        })
    })
</script>
<!--收藏按钮JS End-->

<script type="text/javascript">
    function openAddress() {
        alert('get in');
        wx.openAddress({
            success: function (data) {
                // 用户成功拉出地址
                alert(data.userName + '  ' + data.provinceName + data.cityName);
            },
            cancel: function () {
                // 用户取消拉出地址
                alert('failed');
            }});
    }
    var $$ = function (obj) {
        if (obj != null && obj != undefined && obj.toString().length > 0) {
            if (obj[0] == '#') {
                return document.getElementById(obj.substr(1, obj.length - 1));
            }
        }
    }
    function chgNum(a) {
        //debugger;
        var ret = option_selected();
        var val = $("#xzmodal").attr("class");
        var array = val.split(" ");
        if(ret.no!=''){
            if(array[1] == "in"){
                tip("请选择" + ret.no + "!",true);
            }else{
                $('#xzmodal').modal('show');
            }
            return;
        };
        var total = parseInt($("#goodstotail").text());
        //var option_total = $("#optiontotal").val();
        var number = $$("#total");
        var p = parseInt(number.value);
        if (a == 1) {
            //if(total > 0){
            if (p < 1038) number.value = ++p;
            //var temp_total = total-1;
            //$("#goodstotail").html(temp_total);
            //}
        }
        else {
            //if(total < option_total-1){
            if (p > 1) number.value = --p;
            //var temp_total = total+1;
            //$("#goodstotail").html(temp_total);
            //}
        }
    }
</script>

<!--@php  include page('footer');@-->	